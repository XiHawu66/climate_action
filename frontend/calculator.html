<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Footprint</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/prettyPhoto.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery.js"></script>

    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="images/ico/icon.ico">

    <script type="text/javascript">

        let host = 'localhost';
        let port = '9191';

        const calculation_url = `http://${host}:${port}/api/footprint_calculation`;
        const household_url = `http://${host}:${port}/api/household`;
        const households_url = `http://${host}:${port}/api/households`;
        const bedroom_url = `http://${host}:${port}/api/bedroom`;
        const lighting_url = `http://${host}:${port}/api/category_type?cid=4`;
        const hotwater_url = `http://${host}:${port}/api/category_type?cid=2`;
        const heating_url = `http://${host}:${port}/api/category_type?cid=1`;
        const fridge_url = `http://${host}:${port}/api/category_type?cid=3`;
        const dryer_url = `http://${host}:${port}/api/category_type?cid=7`;
        const solar_system_url = `http://${host}:${port}/api/solar_system`;
        const hot_water_recommendation_url = `http://${host}:${port}/api/hot_water_recommendation`;
        const lighting_recommendation_url = `http://${host}:${port}/api/lighting_recommendation`;
        const fridge_recommendation_url = `http://${host}:${port}/api/fridge_recommendation`;
        const dryer_recommendation_url = `http://${host}:${port}/api/dryer_recommendation`;

        function btn(){

            const requestData = [
                {cid:1,tid:document.getElementById("heating").value,pid:document.getElementById("household").value,bid:document.getElementById("bedroom").value,load:document.getElementById("dryer-load").value},
                {cid:2,tid:document.getElementById("hot_water").value,pid:document.getElementById("household").value,bid:document.getElementById("bedroom").value,load:document.getElementById("dryer-load").value},
                {cid:3,tid:document.getElementById("fridge").value,pid:document.getElementById("household").value,bid:document.getElementById("bedroom").value,load:document.getElementById("dryer-load").value},
                {cid:4,tid:document.getElementById("lighting").value,pid:document.getElementById("household").value,bid:document.getElementById("bedroom").value,load:document.getElementById("dryer-load").value},
                {cid:7,tid:document.getElementById("dryer").value,pid:document.getElementById("household").value,bid:document.getElementById("bedroom").value,load:document.getElementById("dryer-load").value},
                {cid:8,tid:34,pid:document.getElementById("household").value,bid:document.getElementById("bedroom").value,load:document.getElementById("dryer-load").value}
            ];

            window.sessionStorage.setItem('solar_system',document.getElementById("solar").value);

            // alert(JSON.stringify(requestData))

            fetch(calculation_url,{
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
                .then(response => response.json()).then(
                response => {
                    console.log(response);
                    let value = 0;
                    let totalKwUsage = 0;
                    response.forEach((x) => {
                        window.sessionStorage.setItem(`${x.categoryId}_co2InKg`,x.co2InKg.toFixed(0));
                        window.sessionStorage.setItem(`${x.categoryId}_co2Saving`,x.co2Saving.toFixed(0));
                        window.sessionStorage.setItem(`${x.categoryId}_moneySaving`,x.moneySaving.toFixed(0));
                        value += x.co2InKg;
                        totalKwUsage += x.kwUsage;
                    })

                    window.sessionStorage.setItem('total_emission',value.toFixed(0));
                    window.sessionStorage.setItem('total_kw_usage',totalKwUsage);

                    setHotWaterRecommendation(document.getElementById("solar").value);
                    setLightingRecommendation();
                    setFridgeRecommendation();
                    setDryerRecommendation();

                    compare(value);
                }
            );
        }

        function setHotWaterRecommendation(solarValue) {
            fetch(hot_water_recommendation_url + "?pid=" + document.getElementById("household").value + "&cid=2&tid=" + document.getElementById("hot_water").value)
            .then(response => response.json()).then(
                response => {
                    let recommendation = "";
                    if (response.co2KgReduction === 0) {
                        recommendation += `&nbsp;&nbsp;&nbsp;*Your ${response.currentCategoryType} is very efficient. When your system is ready for replacement recommend a higher Heat Pump.`;
                    }
                    else {
                        recommendation += `&nbsp;&nbsp;&nbsp;*Moving from your current ${response.currentCategoryType} hot water system to a Heat Pump could reduce your annual CO2 by ${response.co2KgReduction.toFixed(0)} KG.`;
                        recommendation += `<br>&nbsp;&nbsp;&nbsp;*With grid consumption you could save $${response.gridSaving.toFixed(0)} per year. Heat pumps are a great in combination with solar.`;
                        recommendation += `<br>&nbsp;&nbsp;&nbsp;*With solar the savings could be $${response.solarSaving.toFixed(0)}, based on an export price of ${response.exportPrice * 100}c per kwh.`;
                    }

                    if (solarValue !== 0) {
                        recommendation += `<br>&nbsp;&nbsp;&nbsp;*You can increase solar self consumption by timing your system to heat during the peak production between 11am and 1pm.`;
                    }

                    recommendation += `<br>&nbsp;&nbsp;&nbsp;*A tank size of ${response.suggestedTankSize} is recomended for a houshold of ${document.getElementById("household").value} person/people`;
                    recommendation += `<br>&nbsp;&nbsp;&nbsp;*If you have the roof space you might also consider an Electric boosted system. However, if roof space is tight is often more sensible to add additional solar panels.`;
                    if (response.currentFuel === "gas") {
                        recommendation += `<br>&nbsp;&nbsp;&nbsp;*Once all your gas appliances are removed. Disconecting your gas will save between $250 and $360 per year.`;
                    }
                    else if (response.currentFuel === "lpg") {
                        recommendation += `<br>&nbsp;&nbsp;&nbsp;*Once all your gas appliances are removed. Disconecting your gas eliminates delivery fees.`
                    }
                    window.sessionStorage.setItem('hot_water_recommendation',recommendation);
                }
            )
        }

        function setLightingRecommendation() {
            fetch(lighting_recommendation_url + "?pid=" + document.getElementById("household").value + "&cid=4&tid=" + document.getElementById("lighting").value)
                .then(response => response.json()).then(
                    response => {
                        let recommendation = "";
                        if (response.co2KgReduction === 0) {
                            recommendation += `&nbsp;&nbsp;&nbsp;*Your <b>${response.currentCategoryType}</b> installation is very efficient. When it comes time for replacement we recommend LEDs.`;
                        }
                        else {
                            recommendation += `&nbsp;&nbsp;&nbsp;*Moving from your current lighting of <b>${response.currentCategoryType}</b> to a <b>LED</b> could reduce your annual <b>${response.reductionPotential*100}%</b> preventing <b>${response.co2KgReduction.toFixed(0)} Kg</b> of CO2 each year.`;
                            recommendation += `<br>&nbsp;&nbsp;&nbsp;*With grid consumption you could save <b>$${response.gridSaving.toFixed(0)}</b>.`;
                        }

                        window.sessionStorage.setItem('lighting_recommendation',recommendation);
                    }
            )
        }

        function setFridgeRecommendation() {
            fetch(fridge_recommendation_url + "?pid=" + document.getElementById("household").value + "&cid=3&tid=" + document.getElementById("fridge").value)
                .then(response => response.json()).then(
                response => {
                    let recommendation = "";
                    if (response.co2KgReduction === 0) {
                        recommendation += `&nbsp;&nbsp;&nbsp;*Running <b>1</b> fridge is an excellent choice.`;
                    }
                    else {
                        recommendation += `&nbsp;&nbsp;&nbsp;*Itâ€™s more efficient to run one larger fridge/freezer than multiple smaller ones. Running a single fridge would reduce your costs by <b>${response.reductionPotential*100}%</b>% and prevents <b>${response.co2KgReduction.toFixed(0)} Kg</b> of CO2 each year.`;
                        recommendation += `<br>&nbsp;&nbsp;&nbsp;*With grid consumption you could save <b>$${response.gridSaving.toFixed(0)}</b>. It could be even more than. Fridges running in a garage consume far more in the summer heat.`;
                    }

                    recommendation += `<br>&nbsp;&nbsp;&nbsp;*Larger fridges cost more to run. A fridge of <b>${response.suggestedFridgeSize}itres</b> is recomended for a houshold of ${document.getElementById("household").value} person/people`;
                    recommendation += `<br>&nbsp;&nbsp;&nbsp;*Fridges pull small constant loads making them excellent at increasing self consumption of solar for 50% of the day.`

                    window.sessionStorage.setItem('fridge_recommendation',recommendation);
                }
            )
        }

        function setDryerRecommendation() {
            fetch(dryer_recommendation_url + "?pid=" + document.getElementById("household").value + "&cid=7&tid=" + document.getElementById("dryer").value + "&load=" + document.getElementById("dryer-load").value)
                .then(response => response.json()).then(
                response => {
                    let recommendation = "";
                    if (response.co2KgReduction === 0) {
                        recommendation += `&nbsp;&nbsp;&nbsp;*<b>Your Heat Pump</b> installation is the most efficient type of Dryer. Heat pump dryers range between 6 and 10 stars ratings. When looking to replace your dryer, look for a higher star rating.`;
                    }
                    else {
                        recommendation += `&nbsp;&nbsp;&nbsp;*Moving from your current <b>${response.currentCategoryType}</b> Clothes Dryer to a Heat Pump Dryer could reduce your annual <b>${response.reductionPotential*100}%</b>% preventing <b>${response.co2KgReduction.toFixed(0)} Kg</b> of CO2 each year. `;
                        recommendation += `<br>&nbsp;&nbsp;&nbsp;*With grid consumption you could save <b>$${response.gridSaving.toFixed(0)}</b>.`;
                    }

                    recommendation += `<br>&nbsp;&nbsp;&nbsp;*<b>53%</b> of Melbourne households either don't have a dryer or use it less than once per week. Air drying your clothes is always the cheapest option.`;

                    window.sessionStorage.setItem('dryer_recommendation',recommendation);
                }
            )
        }

        function compare(value) {

            let comparison = 0;
            fetch(household_url + '?pid=' + document.getElementById("household").value)
                .then(response => response.json())
                .then(response => {
                    comparison = 100 * (value - response.kwhPerYear * 0.473) / (response.kwhPerYear * 0.473);
                    window.sessionStorage.setItem('comparison',comparison.toFixed(0));
                    if (comparison<0) {
                        window.sessionStorage.setItem('comparison_boolean','lower');
                    }
                    else {
                        window.sessionStorage.setItem('comparison_boolean','higher');
                    }

                    location.href='report.html';
                })
        }

        function updateOptions(options, select) {
            select.options.length = 0;

            for (let i = 0; i < options.length; i++) {
                let option = document.createElement('option');
                option.value = options[i].value;
                option.text = options[i].text;
                select.add(option);
            }
        }

    </script>

    <style>
        .household {
            opacity: 0.2;
            background: #8DBD8A;
            border-radius: 10px;
        }
    </style>



</head><!--/head-->
<body>
<div id="preloader"></div>
    <header class="navbar navbar-fixed-top navbar-inverse " role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                </button>
                 <a class="navbar-brand" href="index.html"><h1>Carbonique</h1></a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="calculator.html">Footprint</a></li>
                    <li><a href="report.html">Recommendation</a></li>
                </ul>
            </div>
        </div>
    </header><!--/header-->

<div id="content-wrapper">
    <section id="blog" class="white">
        <div class="container">
            <br><br>
            <div class="col-md-12">
                <div class="question-form">

<!--                    <br>-->
                    <div class="center gap fade-down section-heading">
<!--                        <div class="gap"></div>-->
                        <h2 class="main-title">Footprint Calculator</h2>
                    </div>
                    <div class="gap"></div>
                    <div class="row">

                        <form>

                            <div class="col-md-12">
                                <div class="form-row">
                                    <div class="form-group col-md-6">

                                        <label for="household">How many people in your household?</label>
                                        <select class="form-control" id="household">
                                        </select>

                                        <script>

                                            fetch(households_url).then(response => response.json())
                                                .then(response => response.map(function (item) {
                                                        return{
                                                            value:item.pid,
                                                            text:item.householdLabel
                                                        }
                                                    }
                                                ))
                                                .then(
                                                    response => {
                                                        let select = document.getElementById('household');
                                                        updateOptions(response, select);
                                                    }
                                                )

                                        </script>


                                    </div>

                                    <div class="form-group col-md-6">
                                        <label for="bedroom">How many bedrooms in your household?</label>
                                        <select class="form-control" id="bedroom">

                                        </select>

                                        <script>

                                            fetch(bedroom_url).then(response => response.json())
                                                .then(response => response.map(function (item) {
                                                        return{
                                                            value:item.bid,
                                                            text:item.bedroomLabel
                                                        }
                                                    }
                                                ))
                                                .then(
                                                    response => {
                                                        let select = document.getElementById('bedroom');
                                                        updateOptions(response, select);
                                                    }
                                                )

                                        </script>
                                    </div>

                                </div>
                            </div>

                            <div class="col-md-12">

                                <div class="form-group col-md-6">
                                    <label for="lighting">What is your major lighting option?</label>
                                    <select class="form-control" id="lighting">
                                    </select>
                                </div>

                                <script>

                                    fetch(lighting_url).then(response => response.json())
                                        .then(response => response.map(function (item) {
                                            return{
                                                value:item.tid,
                                                text:item.typeName
                                            }
                                            }
                                        ))
                                        .then(
                                        response => {
                                            let select = document.getElementById('lighting');
                                            updateOptions(response, select);
                                    }
                                    )

                                </script>

                                <div class="form-group col-md-6">
                                    <label for="hot_water">What is your major hot water option?</label>
                                    <select class="form-control" id="hot_water">
                                    </select>
                                </div>

                                <script>

                                    fetch(hotwater_url).then(response => response.json())
                                        .then(response => response.map(function (item) {
                                                return{
                                                    value:item.tid,
                                                    text:item.typeName
                                                }
                                            }
                                        ))
                                        .then(
                                            response => {
                                                let select = document.getElementById('hot_water');
                                                updateOptions(response, select);
                                            }
                                        )

                                </script>



                                <div class="form-group col-md-6">
                                    <label for="heating">What is your major heating option?</label>
                                    <select class="form-control" id="heating">
                                    </select>
                                </div>

                                <script>

                                    fetch(heating_url).then(response => response.json())
                                        .then(response => response.map(function (item) {
                                                return{
                                                    value:item.tid,
                                                    text:item.typeName
                                                }
                                            }
                                        ))
                                        .then(
                                            response => {
                                                let select = document.getElementById('heating');
                                                updateOptions(response, select);
                                            }
                                        )

                                </script>


                                


                                <div class="form-group col-md-6">
                                    <label for="fridge">How many fridges do you have?</label>
                                    <select class="form-control" id="fridge">
                                    </select>
                                </div>

                                <script>

                                    fetch(fridge_url).then(response => response.json())
                                        .then(response => response.map(function (item) {
                                                return{
                                                    value:item.tid,
                                                    text:item.typeName
                                                }
                                            }
                                        ))
                                        .then(
                                            response => {
                                                let select = document.getElementById('fridge');
                                                updateOptions(response, select);
                                            }
                                        )

                                </script>


                                <div class="form-group col-md-6">
                                    <label for="dryer">What kind of cloths dryer do you have?</label>
                                    <select class="form-control" id="dryer">
                                    </select>
                                </div>

                                <script>

                                    fetch(dryer_url).then(response => response.json())
                                        .then(response => response.map(function (item) {
                                                return{
                                                    value:item.tid,
                                                    text:item.typeName
                                                }
                                            }
                                        ))
                                        .then(
                                            response => {
                                                let select = document.getElementById('dryer');
                                                updateOptions(response, select);
                                            }
                                        )

                                </script>

                                <div class="form-group col-md-6">
                                    <label for="solar">What is the size of your solar system?</label>
                                    <select class="form-control" id="solar">
                                    </select>
                                </div>

                                <script>

                                    fetch(solar_system_url).then(response => response.json())
                                        .then(response => response.map(function (item) {
                                                return{
                                                    value:item.kw,
                                                    text:item.kw + " kw"
                                                }
                                            }
                                        ))
                                        .then(
                                            response => {
                                                let select = document.getElementById('solar');
                                                select.options.length = 0;
                                                let option = document.createElement('option');

                                                for (let i = 0; i < response.length; i++) {
                                                    option = document.createElement('option');
                                                    option.value = response[i].value;
                                                    option.text = response[i].text;
                                                    select.add(option);
                                                }
                                                option.value = "0";
                                                option.text = "Don't Have Solar System";
                                                select.add(option)
                                            }
                                        )

                                </script>

                                <div class="form-group col-md-6">
                                    <label for="dryer">How many times using your dryer per week normally?</label>
                                    <select class="form-control" id="dryer-load">
                                    </select>
                                </div>

                                <script>
                                    let select = document.getElementById('dryer-load');
                                    select.options.length = 0;

                                    for (let i = 0; i < 10; i++) {
                                        let option = document.createElement('option');
                                        option.value = "" + (i + 1);
                                        option.text = "" + (i + 1);
                                        select.add(option);
                                    }
                                </script>


                                <br><br><br><br><br><br>
                                <div class="form-group col-md-8">
                                    <button id="submit" type="button" class="btn btn-primary" onclick="btn()">SUBMIT</button>
                                </div>
                                <br><br><br><br><br>

                            </div>

                        </form>

                    </div>


                </div>

            </div>

        </div>
    </section>


</div><!-- row -->
<div class="gap"></div>
</div>
</section>
</div>

    <div id="footer-wrapper">
        <section id="bottom" class="">
            <div class="container">
                <div class="row">
                     

                    <div class="col-md-3 col-sm-6">
                        <h4>Sponsors</h4>
                        <div>
                            <ul class="arrow">
                                <li><a href="#arrow">Energy Victoria</a></li>
                                <li><a href="#arrow">Clean Energy Regulator</a></li>
                                <li><a href="#arrow">Sustainability Victoria</a></li>
                                <li><a href="#arrow">Community groups</a></li>
                                <li><a href="#arrow">Energy Retailer</a></li>
                                <li><a href="#arrow">Energy Wholesaler</a></li>
                            </ul>
                        </div>
                    </div><!--/.col-md-3-->

                    <div class="col-md-3 col-sm-6">
                        <h4>Latest Articles</h4>
                        <div>
                            <div class="media">
                                <div class="pull-left">
                                    <img class="widget-img" src="images/portfolio/folio1.jpg" alt="">
                                </div>
                                <div class="media-body">
                                    <span class="media-heading"><a href="#">Blog Post A</a></span>
                                    <small class="muted">Posted 14 April 2019</small>
                                </div>
                            </div>
                            <div class="media">
                                <div class="pull-left">
                                    <img class="widget-img" src="images/portfolio/folio2.jpg" alt="">
                                </div>
                                <div class="media-body">
                                    <span class="media-heading"><a href="#">Blog Post B</a></span>
                                    <small class="muted">Posted 14 April 2019</small>
                                </div>
                            </div>
                        </div>
                    </div><!--/.col-md-3-->

                    <div class="col-md-3 col-sm-6">
                        <h4>Contact Us</h4>
                        <address>
                            <strong>TA11</strong><br>
                            Wellington Rd<br>
                            Clayton VIC 3800<br>
                            <abbr title="Phone"><i class="fa fa-phone"></i></abbr> +61 0421 790 341
                        </address>
                    </div> <!--/.col-md-3-->
                </div>
            </div>
        </section><!--/#bottom-->

        <footer id="footer" class="">
            <div class="container">
                <div class="row">
                    <div class="col-sm-8">
                        Copyright &copy; TA11 All rights reserved.
                    </div>
                    <div class="col-sm-4">
                        <ul class="pull-right">
                            <li><a id="gototop" class="gototop" href="#"><i class="fa fa-chevron-up"></i></a></li><!--#gototop-->
                        </ul>
                    </div>
                </div>
            </div>
        </footer><!--/#footer-->
    </div>


    <script src="js/plugins.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.prettyPhoto.js"></script>
    
    <script src="js/init.js"></script>
</body>
</html>