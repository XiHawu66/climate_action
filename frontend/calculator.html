<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Footprint</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/prettyPhoto.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery.js"></script>

    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="images/ico/icon.ico">

    <script type="text/javascript">


        // document.getElementById('submit').addEventListener('click', function () {
        //     // check for and report errors here
        //     for(let index = 0; index < document.forms.length; index++ ) {
        //         document.forms[index].submit();
        //     }
        // } );

        function btn(){
            const calculation_url = `http://localhost:9090/api/footprint_calculation`;

            const requestData = [
                {cid:2,tid:document.getElementById("hot_water").value,pid:document.getElementById("household").value,bid:document.getElementById("bedroom").value},
                {cid:4,tid:document.getElementById("lighting").value,pid:document.getElementById("household").value,bid:document.getElementById("bedroom").value}
                ];

            // alert(JSON.stringify(requestData))

            fetch(calculation_url,{
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
                .then(response => response.json()).then(
                response => {
                    console.log(response);
                    let value = 0;
                    response.forEach((x) => {
                        window.sessionStorage.setItem(`${x.categoryId}_co2InKg`,x.co2InKg.toFixed(2));
                        window.sessionStorage.setItem(`${x.categoryId}_co2Saving`,x.co2Saving.toFixed(2));
                        window.sessionStorage.setItem(`${x.categoryId}_moneySaving`,x.moneySaving.toFixed(2));
                        value += x.co2InKg;
                    })

                    window.sessionStorage.setItem('total_emission',value.toFixed(2));
                    compare(value);
                }
            )
        }

        function compare(value) {
            const household_url = `http://localhost:9090/api/household`;
            let comparison = 0;
            fetch(household_url + '?pid=' + document.getElementById("household").value)
                .then(response => response.json())
                .then(response => {
                    comparison = 100 * (value - response.kwhPerYear * 0.21 * 0.2333) / (response.kwhPerYear * 0.2333);
                    window.sessionStorage.setItem('comparison',comparison.toFixed(0));
                    if (comparison<0) {
                        window.sessionStorage.setItem('comparison_boolean','lower');
                    }
                    else {
                        window.sessionStorage.setItem('comparison_boolean','higher');
                    }

                    location.href='report.html';
                })
        }

        function updateOptions(options, select) {
            select.options.length = 0;

            for (var i = 0; i < options.length; i++) {
                var option = document.createElement('option');
                option.value = options[i].value;
                option.text = options[i].text;
                select.add(option);
            }
        }

    </script>



</head><!--/head-->
<body>
<div id="preloader"></div>
    <header class="navbar navbar-fixed-top navbar-inverse " role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                </button>
                 <a class="navbar-brand" href="index.html"><h1>Carbonique</h1></a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="calculator.html">Footprint</a></li>
                    <li><a href="report.html">Recommendation</a></li>
                </ul>
            </div>
        </div>
    </header><!--/header-->

<div id="content-wrapper">
    <section id="blog" class="white">
        <div class="container">
            <br>
            <div class="center gap fade-down section-heading">
                <div class="gap"></div>
                <h2 class="main-title">Footprint Calculator</h2>
            </div>
            <div class="gap"></div>
            <div class="row">

                <form>
                    <div class="col-md-12">
                        <div class="form-row">
                            <div class="form-group col-md-6">

                                <label for="household">How many people in your household?</label>
                                <select class="form-control" id="household">
                                </select>

                                <script>

                                    fetch('http://localhost:9090/api/households').then(response => response.json())
                                        .then(response => response.map(function (item) {
                                                return{
                                                    value:item.pid,
                                                    text:item.householdLabel
                                                }
                                            }
                                        ))
                                        .then(
                                            response => {
                                                const select = document.getElementById('household');
                                                updateOptions(response, select);
                                            }
                                        )

                                </script>
<!--                                <fieldset  class="form-inline">-->
<!--                                    <br>-->
<!--                                    <div class="radio">-->
<!--                                        <label for="option1">-->
<!--                                            <input type="radio" name="optionsRadios" id="option1" value="option1" checked>-->
<!--                                            1-->
<!--                                        </label>-->
<!--                                    </div>&nbsp;&nbsp;&nbsp;-->

<!--                                    <div class="radio">-->
<!--                                        <label for="option2">-->
<!--                                            <input type="radio" name="optionsRadios" id="option2" value="option2">-->
<!--                                            2-->
<!--                                        </label>-->
<!--                                    </div>&nbsp;&nbsp;&nbsp;-->

<!--                                    <div class="radio">-->
<!--                                        <label for="option3">-->
<!--                                            <input type="radio" name="optionsRadios" id="option3" value="option3">-->
<!--                                            3-->
<!--                                        </label>-->
<!--                                    </div>&nbsp;&nbsp;&nbsp;-->

<!--                                    <div class="radio">-->
<!--                                        <label for="option4">-->
<!--                                            <input type="radio" name="optionsRadios" id="option4" value="option4">-->
<!--                                            4-->
<!--                                        </label>-->
<!--                                    </div>&nbsp;&nbsp;&nbsp;-->

<!--                                    <div class="radio">-->
<!--                                        <label for="option5">-->
<!--                                            <input type="radio" name="optionsRadios" id="option5" value="option5">-->
<!--                                            5+-->
<!--                                        </label>-->
<!--                                    </div>-->

<!--                                </fieldset >-->

                            </div>

                            <div class="form-group col-md-6">
                                <label for="bedroom">How many bedrooms in your household?</label>
                                <select class="form-control" id="bedroom">

                                </select>

                                <script>

                                    fetch('http://localhost:9090/api/bedroom').then(response => response.json())
                                        .then(response => response.map(function (item) {
                                                return{
                                                    value:item.bid,
                                                    text:item.bedroomLabel
                                                }
                                            }
                                        ))
                                        .then(
                                            response => {
                                                const select = document.getElementById('bedroom');
                                                updateOptions(response, select);
                                            }
                                        )

                                </script>
                            </div>

                        </div>
                    </div>

                    <div class="col-md-12">

                        <div class="form-group col-md-6">
                            <label for="lighting">What is your major lighting option?</label>
                            <select class="form-control" id="lighting">
                            </select>
                        </div>

                        <script>

                            fetch('http://localhost:9090/api/category_type?cid=4').then(response => response.json())
                                .then(response => response.map(function (item) {
                                    return{
                                        value:item.tid,
                                        text:item.typeName
                                    }
                                    }
                                ))
                                .then(
                                response => {
                                    const select = document.getElementById('lighting');
                                    updateOptions(response, select);
                            }
                            )

                        </script>

<!--                        <div class="form-group col-md-4">-->
<!--                            <label for="heating">What is your major heating option?</label>-->
<!--                            <select class="form-control" id="heating">-->
<!--                            </select>-->
<!--                        </div>-->

                        <div class="form-group col-md-6">
                            <label for="hot_water">What is your major hot water option?</label>
                            <select class="form-control" id="hot_water">
                            </select>
                        </div>

                        <script>

                            fetch('http://localhost:9090/api/category_type?cid=2').then(response => response.json())
                                .then(response => response.map(function (item) {
                                        return{
                                            value:item.tid,
                                            text:item.typeName
                                        }
                                    }
                                ))
                                .then(
                                    response => {
                                        const select = document.getElementById('hot_water');
                                        updateOptions(response, select);
                                    }
                                )

                        </script>



                        <div class="form-group col-md-6">
                            <label for="heating">What is your major heating option?</label>
                            <select class="form-control" id="heating">
                            </select>
                        </div>

                        <script>

                            fetch('http://localhost:9090/api/category_type?cid=1').then(response => response.json())
                                .then(response => response.map(function (item) {
                                        return{
                                            value:item.tid,
                                            text:item.typeName
                                        }
                                    }
                                ))
                                .then(
                                    response => {
                                        const select = document.getElementById('heating');
                                        updateOptions(response, select);
                                    }
                                )

                        </script>



                        <div class="form-group col-md-6">
                            <label for="laundry">How often do you use your dryer per week?</label>
                            <select class="form-control" id="laundry">
                            </select>
                        </div>

                        <script>

                            fetch('http://localhost:9090/api/category_type?cid=7').then(response => response.json())
                                .then(response => response.map(function (item) {
                                        return{
                                            value:item.tid,
                                            text:item.typeName
                                        }
                                    }
                                ))
                                .then(
                                    response => {
                                        const select = document.getElementById('laundry');
                                        updateOptions(response, select);
                                    }
                                )

                        </script>



                        <br><br><br><br><br><br>
                        <div class="form-group col-md-4">
                            <button id="submit" type="button" class="btn btn-primary" onclick="btn()">SUBMIT</button>
                        </div>
                        <br><br><br><br><br><br>

                    </div>

                </form>

            </div>


        </div>
    </section>


</div><!-- row -->
<div class="gap"></div>

    <div id="footer-wrapper">
        <section id="bottom" class="">
            <div class="container">
                <div class="row">
                     

                    <div class="col-md-3 col-sm-6">
                        <h4>Sponsors</h4>
                        <div>
                            <ul class="arrow">
                                <li>Energy Victoria</li>
                                <li>Clean Energy Regulator</li>
                                <li>Sustainability Victoria</li>
                                <li>Community groups</li>
                                <li>Energy Retailer</li>
                                <li>Energy Wholesaler</li>
                            </ul>
                        </div>
                    </div><!--/.col-md-3-->

                    <div class="col-md-3 col-sm-6">
                        <h4>Latest Articles</h4>
                        <div>
                            <div class="media">
                                <div class="pull-left">
                                    <img class="widget-img" src="images/portfolio/folio1.jpg" alt="">
                                </div>
                                <div class="media-body">
                                    <span class="media-heading"><a href="#">Blog Post A</a></span>
                                    <small class="muted">Posted 14 April 2019</small>
                                </div>
                            </div>
                            <div class="media">
                                <div class="pull-left">
                                    <img class="widget-img" src="images/portfolio/folio2.jpg" alt="">
                                </div>
                                <div class="media-body">
                                    <span class="media-heading"><a href="#">Blog Post B</a></span>
                                    <small class="muted">Posted 14 April 2019</small>
                                </div>
                            </div>
                        </div>
                    </div><!--/.col-md-3-->

                    <div class="col-md-3 col-sm-6">
                        <h4>Contact Us</h4>
                        <address>
                            <strong>TA11</strong><br>
                            Wellington Rd<br>
                            Clayton VIC 3800<br>
                            <abbr title="Phone"><i class="fa fa-phone"></i></abbr> +61 0421 790 341
                        </address>
                    </div> <!--/.col-md-3-->
                </div>
            </div>
        </section><!--/#bottom-->

        <footer id="footer" class="">
            <div class="container">
                <div class="row">
                    <div class="col-sm-8">
                        Copyright &copy; TA11 All rights reserved.
                    </div>
                    <div class="col-sm-4">
                        <ul class="pull-right">
                            <li><a id="gototop" class="gototop" href="#"><i class="fa fa-chevron-up"></i></a></li><!--#gototop-->
                        </ul>
                    </div>
                </div>
            </div>
        </footer><!--/#footer-->
    </div>


    <script src="js/plugins.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.prettyPhoto.js"></script>
    
    <script src="js/init.js"></script>
</body>
</html>